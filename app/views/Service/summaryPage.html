#{extends 'layout.html' /}
#{set title:'Product Summary | Digital Marketplace' /}

#{breadcrumb-one-deep
  service_name: listing.title,
  service_id: service_id
/}

%{
  if (confirmDeleteMessage) {
}%
  <div class='banner-warning'>
    <p>
      ${confirmDeleteMessage}
    </p>
    #{form @Service.delete()}
        <input type="hidden" id="listingId" name="listingId" value="${listingId}" />
        %{
        if (listing.title) {
        }%
        <input type='submit' value='Yes, delete &ldquo;${listing.title}&rdquo;' class='banner-action button-destructive' />
        %{
            } else {
         }%
        <input type='submit' value='Yes, delete this service' class='banner-action button-destructive' />
    %{
        }
        }%
    #{/form}
  </div>
%{
  }
}%

#{heading
  title: 'Summary',
/}

<p class='question-hint'>
  Last edited by ${listing.lastUpdatedEmail} at
  ${listing.getLastUpdated()}
</p>
<p class='question-hint'>
  %{ if (listing.serviceSubmitted) { }%
  Completed by
  ${listing.lastCompletedByEmail} at ${listing.getLastCompleted()}%{ } }%
</p>

#{summary/section/start
  title: content.get('p' + pageIndex + 'title'),
/}
  #{summary/row
    question: content.get('p' + pageIndex + 'q1' + 'text'),
    answer: listing.lot,
    serviceTypeQuestion: true
  /}
#{summary/section/end /}

%{
  for (page in flow) {
}%

  #{summary/section/start
    title: content.get('p' + page + 'title'),
    page_list_number: ++pageIndex,
    page: page,
    service_id: service_id
  /}

    %{
      for (questionIndex in (1..maxPossibleNumberOfQuestions).toArray()) {
        question = 'p' + page + 'q' + questionIndex;
        questionIsRelevantToSelectedLot = content.get(question + 'lots')?.contains(listing.lot)
        if (questionIsRelevantToSelectedLot) {
    }%
      #{summary/row
        question: content.get(question + 'text'),
        answer: storedValues.get(question),
        assurance: storedValues.get(question + 'assurance')?.get(0),
        optional: optionalQuestions.contains(question)
      /}

    %{
        }
      }
    }%

  #{summary/section/end /}

%{
  }
}%



<div class='page-footer'>
%{
  if (listing.allPagesHaveBeenCompleted()) {
}%
  #{form @Service.completeListing()}
  <div class='page-footer-item'>
    <input type="hidden" id="listingId" name="listingId" value="${listingId}" />
    #{forms/selection-button-checkbox
      name: 'serviceCompleted',
      value: 'service-completed',
      label: 'This service is completed'
    /}
  </div>
  <input type='submit' value='Save and return to submissions' class='page-footer-item button-save' />
  #{/form}
%{
  } else {
}%
  <p class='summary-incomplete-message'>
    Your progress has been saved, but you must answer all required
    questions before you can complete your service
  </p>
  <a href='/' class='page-footer-item summary-return-link'>Return to submissions</a>
%{
  }
}%
%{
  if (!confirmDeleteMessage) {
}%
    #{form @Service.showDeletePage()}
        <input type="hidden" id="listingId" name="listingId" value="${listingId}" />
        <input type='submit' id="showDeleteMessage" name="showDeleteMessage" value='Delete this service' class='page-footer-item button-destructive' />
    #{/form}
%{
  }
}%
</div>
